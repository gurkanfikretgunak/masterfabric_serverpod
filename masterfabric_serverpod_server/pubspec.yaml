name: masterfabric_serverpod_server
description: Starting point for a Serverpod server.
# version: 1.0.0
# homepage: https://www.example.com

environment:
  sdk: '^3.8.0'

dependencies:
  serverpod: 3.2.3
  serverpod_auth_idp_server: 3.2.3
  serverpod_auth_core_server: 3.2.3
  uuid: ^4.5.1
  crypto: ^3.0.3  # For secure hashing (SHA-256) of verification codes
  # firebase_admin: ^1.0.0  # For Firebase integration (uncomment if needed)
  # sentry: ^7.0.0  # For Sentry integration (uncomment if needed)
  # mixpanel_dart: ^1.0.0  # For Mixpanel integration (uncomment if needed)
  cron: ^0.6.0  # For cron expression parsing
  yaml: ^3.1.2  # For reading YAML config files
  # totp_generator and qr packages removed - 2FA uses custom TOTP implementation

dev_dependencies:
  lints: '>=3.0.0 <7.0.0'
  serverpod_test: 3.2.3
  test: ^1.25.5


serverpod:
  scripts:
    # Starts the server and applies migrations
    start: dart bin/main.dart --apply-migrations

    # Seed app configuration data
    seed-app-config:
      windows: powershell -ExecutionPolicy Bypass -File scripts\seed_app_config.ps1
      posix: bash scripts/seed_app_config.sh

    # Seed translations from JSON files
    seed-translations:
      windows: dart bin/seed_translations.dart
      posix: dart bin/seed_translations.dart

    # Build the Flutter web app and copy it to the server's web directory.
    # Windows uses xcopy since flutter's --output flag doesn't work there.
    # See: https://github.com/flutter/flutter/issues/157886
    flutter_build:
      windows: >-
        (if exist web\app rmdir /S /Q web\app)
        & cd /D ..\masterfabric_serverpod_flutter
        && flutter build web --base-href /app/ --wasm
        && xcopy /E /I /Y build\web ..\masterfabric_serverpod_server\web\app
      posix: |
        cd ../masterfabric_serverpod_flutter
        flutter build web --base-href /app/ --wasm --output ../masterfabric_serverpod_server/web/app
